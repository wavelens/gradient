<!--
 * SPDX-FileCopyrightText: 2025 Wavelens UG <info@wavelens.io>
 *
 * SPDX-License-Identifier: AGPL-3.0-only
 -->

 {% extends 'dashboard/settings/base.html' %}


 <head>
     {% load static %}
     {% load i18n %}
 </head>
 
 {% block page_title %}{% trans 'Organization Members' %}{% endblock %}

{% block settings_title %}{% trans 'Organization Members' %}{% endblock %}

{% block navigation_items %}
    {% if org %}
        <li><a class="settings-nav-link" href="{% url 'settingsOrganization' org %}"><span class="material-symbols-outlined m-r-5">apartment</span>{% trans 'Organization' %}</a></li>
    {% endif %}
    <li><a class="settings-nav-link active" href=""><span class="material-symbols-outlined m-r-5">group</span>{% trans 'Members' %}</a></li>
{% endblock %}

 {% block inhalt %}
 <div class="">
    <div class="">
        <h2 class="">{% trans 'Organization Members' %}</h2>
        
        <!-- Add Member Form -->
        <div class="add-member-section">
            <h3>{% trans 'Add New Member' %}</h3>
            {% if add_form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ add_form.non_field_errors }}
                </div>
            {% endif %}
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="add_member" value="1">
                <div class="member-form-layout">
                    <div class="form-field member-form-field">
                        <label for="{{ add_form.user.id_for_label }}" class="required-label">{% trans add_form.user.label %}</label>
                        {{ add_form.user }}
                        {% if add_form.user.errors %}
                            <div class="error">{{ add_form.user.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="form-field member-form-field">
                        <label for="{{ add_form.role.id_for_label }}" class="required-label">{% trans add_form.role.label %}</label>
                        {{ add_form.role }}
                        {% if add_form.role.errors %}
                            <div class="error">{{ add_form.role.errors }}</div>
                        {% endif %}
                    </div>
                    <div>
                        <button type="submit" class="submit-btn">{% trans 'Add Member' %}</button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Members List -->
        <div class="members-list">
            <h3>{% trans 'Current Members' %}</h3>
            {% if members %}
                <div class="members-table-container">
                    <table class="members-table">
                        <thead>
                            <tr>
                                <th >{% trans 'Username' %}</th>
                                <th >{% trans 'Role' %}</th>
                                <th >{% trans 'Actions' %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for member in members %}
                            <tr>
                                <td >{{ member.name }}</td>
                                <td >
                                    <form method="post" style="display: inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="edit_role" value="1">
                                        <input type="hidden" name="user" value="{{ member.user }}">
                                        <select name="role" class="form-control member-form-element" onchange="this.form.submit()">
                                            {% for role_value, role_label in role_choices %}
                                                <option value="{{ role_value }}" {% if member.role == role_value %}selected{% endif %}>{{ role_label }}</option>
                                            {% endfor %}
                                        </select>
                                    </form>
                                </td>
                                <td >
                                    <form method="post" style="display: inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="remove_member" value="1">
                                        <input type="hidden" name="user" value="{{ member.id }}">
                                        <button type="submit" class="btn btn-danger btn-sm remove-member-button">
                                            {% trans 'Remove' %}
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="no-members no-members-message">
                    <p>{% trans 'No members found in this organization.' %}</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
 {% endblock %}