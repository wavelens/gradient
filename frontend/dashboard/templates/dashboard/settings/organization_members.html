<!--
 * SPDX-FileCopyrightText: 2025 Wavelens UG <info@wavelens.io>
 *
 * SPDX-License-Identifier: AGPL-3.0-only
 -->

 {% extends 'dashboard/settings/base.html' %}


 <head>
     {% load static %}
     {% load i18n %}
 </head>
 
 {% block page_title %}{% trans 'Organization Members' %}{% endblock %}

{% block settings_title %}{% trans 'Organization Members' %}{% endblock %}

{% block navigation_items %}
    {% if org %}
        <li><a class="settings-nav-link" href="{% url 'settingsOrganization' org %}"><span class="material-symbols-outlined m-r-5">apartment</span>{% trans 'Organization' %}</a></li>
    {% endif %}
    <li><a class="settings-nav-link active" href=""><span class="material-symbols-outlined m-r-5">group</span>{% trans 'Members' %}</a></li>
{% endblock %}

 {% block inhalt %}
 <div class="">
    <div class="">
        <h2 class="">{% trans 'Organization Members' %}</h2>
        
        <!-- Add Member Form -->
        <div class="add-member-section" style="margin-bottom: 2rem; padding: 1rem; border: 1px solid #ddd; border-radius: 4px;">
            <h3>{% trans 'Add New Member' %}</h3>
            {% if add_form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ add_form.non_field_errors }}
                </div>
            {% endif %}
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="add_member" value="1">
                <div style="display: flex; gap: 1rem; align-items: end;">
                    <div class="form-field" style="flex: 1;">
                        <label for="{{ add_form.user.id_for_label }}" class="required-label">{% trans add_form.user.label %}</label>
                        {{ add_form.user }}
                        {% if add_form.user.errors %}
                            <div class="error">{{ add_form.user.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="form-field" style="flex: 1;">
                        <label for="{{ add_form.role.id_for_label }}" class="required-label">{% trans add_form.role.label %}</label>
                        {{ add_form.role }}
                        {% if add_form.role.errors %}
                            <div class="error">{{ add_form.role.errors }}</div>
                        {% endif %}
                    </div>
                    <div>
                        <button type="submit" class="submit-btn">{% trans 'Add Member' %}</button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Members List -->
        <div class="members-list">
            <h3>{% trans 'Current Members' %}</h3>
            {% if members %}
                <div class="members-table" style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                        <thead>
                            <tr style="background-color: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <th style="padding: 0.75rem; text-align: left; border: 1px solid #dee2e6;">{% trans 'Username' %}</th>
                                <th style="padding: 0.75rem; text-align: left; border: 1px solid #dee2e6;">{% trans 'Role' %}</th>
                                <th style="padding: 0.75rem; text-align: left; border: 1px solid #dee2e6;">{% trans 'Actions' %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for member in members %}
                            <tr style="border-bottom: 1px solid #dee2e6;">
                                <td style="padding: 0.75rem; border: 1px solid #dee2e6;">{{ member.user }}</td>
                                <td style="padding: 0.75rem; border: 1px solid #dee2e6;">
                                    <form method="post" style="display: inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="edit_role" value="1">
                                        <input type="hidden" name="user" value="{{ member.user }}">
                                        <select name="role" class="form-control" style="display: inline-block; width: auto; min-width: 120px;" onchange="this.form.submit()">
                                            {% for role_value, role_label in role_choices %}
                                                <option value="{{ role_value }}" {% if member.role == role_value %}selected{% endif %}>{{ role_label }}</option>
                                            {% endfor %}
                                        </select>
                                    </form>
                                </td>
                                <td style="padding: 0.75rem; border: 1px solid #dee2e6;">
                                    <form method="post" style="display: inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="remove_member" value="1">
                                        <input type="hidden" name="user" value="{{ member.user }}">
                                        <button type="submit" class="btn btn-danger btn-sm" style="background-color: #dc3545; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 3px; cursor: pointer;">
                                            {% trans 'Remove' %}
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="no-members" style="padding: 2rem; text-align: center; color: #6c757d; border: 1px solid #dee2e6; border-radius: 4px; margin-top: 1rem;">
                    <p>{% trans 'No members found in this organization.' %}</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
 {% endblock %}