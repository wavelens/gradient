<!--
 * SPDX-FileCopyrightText: 2025 Wavelens UG <info@wavelens.io>
 *
 * SPDX-License-Identifier: AGPL-3.0-only
 -->

{% extends 'dashboard/settings/base.html' %}


<head>
    {% load static %}
    {% load i18n %}
</head>

{% block page_title %}{% trans 'SSH Key Settings' %}{% endblock %}

{% block settings_title %}{% trans 'SSH Key Settings' %}{% endblock %}

{% block navigation_items %}
    <li><a class="settings-nav-link" href="{% url 'settingsOrganization' org %}"><span class="material-symbols-outlined m-r-5">apartment</span>{% trans 'Organization' %}</a></li>
    {% if org %}
        <li><a class="settings-nav-link" href="{% url 'organizationMembers' org %}"><span class="material-symbols-outlined m-r-5">group</span>{% trans 'Members' %}</a></li>
        <li><a class="settings-nav-link" href="{% url 'organizationServers' org %}"><span class="material-symbols-outlined m-r-5">dns</span>{% trans 'Servers' %}</a></li>
        <li><a class="settings-nav-link active" href=""><span class="material-symbols-outlined m-r-5">key</span>{% trans 'SSH Key' %}</a></li>
    {% endif %}
{% endblock %}

{% block inhalt %}
<div class="container">
    <div class="header m-b-1rem">
        <div>
            <h1>{% trans 'SSH Key Management' %}</h1>
        </div>
    </div>
    
    <div class="">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        
        <div class="settings-section">
            <h3>{% trans 'SSH Public Key' %}</h3>
            <p>{% trans 'Use this public key to authenticate with external services. The key is automatically generated for your organization.' %}</p>
            
            {% if ssh_public_key %}
                <div class="ssh-key-container">
                    <textarea readonly class="ssh-key-display" onclick="this.select()">{{ ssh_public_key }}</textarea>
                    <div class="ssh-key-actions">
                        <button type="button" class="copy-button" onclick="copyToClipboard('{{ ssh_public_key|escapejs }}')">{% trans 'Copy' %}</button>
                        <form method="post" action="{% url 'organizationSSHGenerate' org %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="generate-button">{% trans 'Generate New Key' %}</button>
                        </form>
                    </div>
                </div>
            {% else %}
                <div class="no-key-container">
                    <p>{% trans 'No SSH public key available.' %}</p>
                    <form method="post" action="{% url 'organizationSSHGenerate' org %}">
                        {% csrf_token %}
                        <button type="submit" class="generate-button">{% trans 'Generate SSH Key' %}</button>
                    </form>
                </div>
            {% endif %}
        </div>
    </div>
</div>


<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = '{% trans "Copied!" %}';
        setTimeout(function() {
            button.textContent = originalText;
        }, 2000);
    }).catch(function(err) {
        console.error('Failed to copy text: ', err);
    });
}
</script>
{% endblock %}