<!--
 * SPDX-FileCopyrightText: 2025 Wavelens UG <info@wavelens.io>
 *
 * SPDX-License-Identifier: AGPL-3.0-only OR WL-1.0
 -->

 {% extends 'dashboard/index.html' %}

 <head>
    {% load static %}
    {% load i18n %}
</head>

{% block title %}{% trans 'New Server' %}{% endblock %}

{% block content %}
<div class="outer-form">
    <div class="form-container">
        <h2 class="form-header-label">{% trans 'New Server' %}</h2>
        <form method="post" id="server-form">
            {% csrf_token %}
            {% for field in form %}
                {% if field.name == 'architectures' %}
                    <div class="form-field">
                        <label for="{{ field.id_for_label }}" {% if field.field.required %}class="required-label"{% endif %}>{% trans field.label %}</label>
                        {{ field }}
                        <div class="tag-input-container">
                            <div class="tags-display" id="architectures-tags"></div>
                            <input type="text" class="form-control tag-input" id="architectures-input">
                        </div>
                        {% if field.errors %}
                            <div class="error">{% trans field.errors %}</div>
                        {% endif %}
                    </div>
                {% elif field.name == 'features' %}
                    <div class="form-field">
                        <label for="{{ field.id_for_label }}" {% if field.field.required %}class="required-label"{% endif %}>{% trans field.label %}</label>
                        {{ field }}
                        <div class="tag-input-container">
                            <div class="tags-display" id="features-tags"></div>
                            <input type="text" class="form-control tag-input" id="features-input">
                        </div>
                        {% if field.errors %}
                            <div class="error">{% trans field.errors %}</div>
                        {% endif %}
                    </div>
                {% elif field.field.widget|default:"" == form.fields.remember_me.widget %}
                    <div class="form-check">
                        {{ field }}
                        <label for="{{ field.id_for_label }}" class="form-check-label">{% trans field.label %}</label>
                    </div>
                {% else %}
                    <div class="form-field">
                        <label for="{{ field.id_for_label }}" {% if field.field.required %}class="required-label"{% endif %}>{% trans field.label %}</label>
                        {{ field }}
                        {% if field.errors %}
                            <div class="error">{% trans field.errors %}</div>
                        {% endif %}
                    </div>
                {% endif %}
            {% endfor %}
            <button type="submit" class="submit-btn">{% trans 'Create' %}</button>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function initTagInput(inputId, displayId, hiddenId) {
        const input = document.getElementById(inputId);
        const display = document.getElementById(displayId);
        const hidden = document.getElementById(hiddenId);
        let tags = [];
        
        function updateHiddenField() {
            hidden.value = tags.join(',');
        }
        
        function addTag(tagText) {
            const trimmed = tagText.trim();
            if (trimmed && !tags.includes(trimmed)) {
                tags.push(trimmed);
                renderTags();
                updateHiddenField();
            }
        }
        
        function removeTag(tagToRemove) {
            tags = tags.filter(tag => tag !== tagToRemove);
            renderTags();
            updateHiddenField();
        }
        
        function renderTags() {
            display.innerHTML = '';
            tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.className = 'tag';
                tagElement.innerHTML = `${tag}`;
                
                const removeButton = document.createElement('button');
                removeButton.type = 'button';
                removeButton.className = 'tag-remove';
                removeButton.innerHTML = '&times;';
                removeButton.onclick = function() {
                    removeTag(tag);
                };
                
                tagElement.appendChild(removeButton);
                display.appendChild(tagElement);
            });
        }
        
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ',') {
                e.preventDefault();
                addTag(input.value);
                input.value = '';
            }
        });
        
        input.addEventListener('blur', function() {
            if (input.value.trim()) {
                addTag(input.value);
                input.value = '';
            }
        });
        
    }
    
    initTagInput('architectures-input', 'architectures-tags', 'id_architectures');
    initTagInput('features-input', 'features-tags', 'id_features');
});
</script>
{% endblock %}